!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=44)}({0:function(e,t,n){"use strict";function r(e){if(e){const t=e.closest(".alerte");t&&t.parentNode&&t.parentNode.removeChild(t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.hideAlerte=r,t.alerte=function(e,t,n={}){let o={backdrop:!0,buttons:[{text:chrome.i18n.getMessage("ok"),callback:null}],targetElement:null};o=Object.assign({},o,n);const i=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),u=document.createElement("div"),l=document.createElement("div");i.className="alerte",a.className="alerte-modal",c.className="alerte-header",c.innerHTML=e,u.className="alerte-body",u.innerHTML=t,l.className="alerte-footer",o.buttons.forEach(e=>{const t=document.createElement("button");t.innerText=e.text,"callback"in e&&e.callback?t.addEventListener("click",t=>e.callback(t)):t.addEventListener("click",e=>r(e.target)),l.appendChild(t)}),s.className="alerte-overlay",o.backdrop&&s.addEventListener("click",e=>r(e.target)),a.appendChild(c),a.appendChild(u),a.appendChild(l),i.appendChild(s),i.appendChild(a),o.targetElement?o.targetElement.appendChild(i):document.body.appendChild(i)}},2:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),i=n(3);class s{getUrl(){return`https://www.${chrome.i18n.getMessage("domainName")}/${this.tomcatInstance()}/${this.servlet}`}tomcatInstance(){return"Scribens"}request(e,t=null){return r(this,void 0,void 0,function*(){return yield fetch(this.getUrl(),{body:this.generateParameters(e),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",signal:t||(new AbortController).signal}).then(e=>e.json()).then(e=>(console.log(e),e)).catch(e=>{if(console.log(e),!/^chrome-extension:\/\/.+\/pages\/.+\.html$/.test(window.location.href))throw new i.NetworkError(e.message);[...document.querySelectorAll(".block-spinner")].forEach(e=>{e.classList.remove("block-spinner","disabled");const t=e.querySelector("button.disabled");t&&(t.classList.remove("block-spinner","disabled"),t.removeAttribute("disabled"))}),o.alerte(chrome.i18n.getMessage("error"),`<p>${chrome.i18n.getMessage("something_went_wrong")}</p>\n            <details>\n              <p>${e}</p>\n            </details>\n            `)})})}generateParameters(e){return Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}}s.plugin="GoogleChrome",t.HttpBase=s},3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NetworkError=class extends Error{constructor(e){super(e),this.name="NetworkError"}}},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.InactivatedAccount=0]="InactivatedAccount",e[e.InvalidPassword=1]="InvalidPassword",e[e.NotExistingId=2]="NotExistingId",e[e.SessionActive=3]="SessionActive"}(t.AuthErrors||(t.AuthErrors={})),function(e){e[e.P1M=0]="P1M",e[e.P3M=1]="P3M",e[e.P1A=2]="P1A",e[e.P1M_RA=3]="P1M_RA",e[e.P3M_RA=4]="P3M_RA",e[e.P1A_RA=5]="P1A_RA",e[e.TRIAL=6]="TRIAL"}(t.SubscriptionType||(t.SubscriptionType={}))},44:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7),o=n(4),i=document.getElementById("main-iframe");i.addEventListener("load",()=>{i.style.height=`${i.contentWindow.document.body.scrollHeight}px`}),chrome.storage.sync.get(["lastPage","userInfo"],e=>{e&&"lastPage"in e&&e.lastPage&&(i.src=e.lastPage),e&&"userInfo"in e&&(new r.IdentificationServlet).estAbonne(e.userInfo[7],e.userInfo[8]).then(e=>e&&Object.keys(o.AuthErrors).includes(e[0])?(chrome.storage.sync.clear(),i.contentWindow.postMessage({cmd:"user-logout",error:chrome.i18n.getMessage(e[0])},"*"),null):e).then(e=>{e&&(chrome.storage.sync.set({userInfo:e}),i.contentWindow.postMessage({cmd:"user-info"},"*"))})})},7:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(2);t.IdentificationServlet=class extends o.HttpBase{constructor(){super(...arguments),this.servlet="Identification_Servlet"}estAbonne(e,t){return r(this,void 0,void 0,function*(){return this.request({FunctionName:"EstAbonne",Id:e,Password:t,plugin:o.HttpBase.plugin})})}identifiantExiste(e){return r(this,void 0,void 0,function*(){return this.request({FunctionName:"IdentifiantExiste",Email:e})})}newSubscription(e,t,n){return r(this,void 0,void 0,function*(){const r=chrome.runtime.getManifest();return this.request({FunctionName:"NewSubscription",Identifiant:e,MotDePasse:t,Prenom:n,Language:r.default_locale,plugin:o.HttpBase.plugin})})}sendMessageEmail(e,t,n,o="CONFIRMATION_INSCRIPTION"){return r(this,void 0,void 0,function*(){const r=chrome.runtime.getManifest();return this.request({FunctionName:"SendMessageEmail",IdMail:o,LangId:r.default_locale,EMail:e,MotDePasse:t,Prenom:n})})}sendSupportEmail(e,t,n){return r(this,void 0,void 0,function*(){return this.request({FunctionName:"SendSupportEmail",Id:e,Name:t,Message:n})})}majData(e,t,n){return r(this,void 0,void 0,function*(){return this.request({FunctionName:"MajData",TableName:"abonnement_client",DataName:t,DataValue:n,Id:e})})}signalSessionActive(e){return r(this,void 0,void 0,function*(){return this.request({FunctionName:"SignalSessionActive",Id:e,plugin:o.HttpBase.plugin})})}}}});