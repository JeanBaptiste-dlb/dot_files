!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=43)}({0:function(e,t,n){"use strict";function r(e){if(e){const t=e.closest(".alerte");t&&t.parentNode&&t.parentNode.removeChild(t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.hideAlerte=r,t.alerte=function(e,t,n={}){let s={backdrop:!0,buttons:[{text:chrome.i18n.getMessage("ok"),callback:null}],targetElement:null};s=Object.assign({},s,n);const o=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div");o.className="alerte",a.className="alerte-modal",c.className="alerte-header",c.innerHTML=e,l.className="alerte-body",l.innerHTML=t,u.className="alerte-footer",s.buttons.forEach(e=>{const t=document.createElement("button");t.innerText=e.text,"callback"in e&&e.callback?t.addEventListener("click",t=>e.callback(t)):t.addEventListener("click",e=>r(e.target)),u.appendChild(t)}),i.className="alerte-overlay",s.backdrop&&i.addEventListener("click",e=>r(e.target)),a.appendChild(c),a.appendChild(l),a.appendChild(u),o.appendChild(i),o.appendChild(a),s.targetElement?s.targetElement.appendChild(o):document.body.appendChild(o)}},1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scribensState={elements:[]},t.scribensUser={info:null,options:null}},2:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(i,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),o=n(3);class i{getUrl(){return`https://www.${chrome.i18n.getMessage("domainName")}/${this.tomcatInstance()}/${this.servlet}`}tomcatInstance(){return"Scribens"}request(e,t=null){return r(this,void 0,void 0,function*(){return yield fetch(this.getUrl(),{body:this.generateParameters(e),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",signal:t||(new AbortController).signal}).then(e=>e.json()).then(e=>(console.log(e),e)).catch(e=>{if(console.log(e),!/^chrome-extension:\/\/.+\/pages\/.+\.html$/.test(window.location.href))throw new o.NetworkError(e.message);[...document.querySelectorAll(".block-spinner")].forEach(e=>{e.classList.remove("block-spinner","disabled");const t=e.querySelector("button.disabled");t&&(t.classList.remove("block-spinner","disabled"),t.removeAttribute("disabled"))}),s.alerte(chrome.i18n.getMessage("error"),`<p>${chrome.i18n.getMessage("something_went_wrong")}</p>\n            <details>\n              <p>${e}</p>\n            </details>\n            `)})})}generateParameters(e){return Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}}i.plugin="GoogleChrome",t.HttpBase=i},3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NetworkError=class extends Error{constructor(e){super(e),this.name="NetworkError"}}},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.InactivatedAccount=0]="InactivatedAccount",e[e.InvalidPassword=1]="InvalidPassword",e[e.NotExistingId=2]="NotExistingId",e[e.SessionActive=3]="SessionActive"}(t.AuthErrors||(t.AuthErrors={})),function(e){e[e.P1M=0]="P1M",e[e.P3M=1]="P3M",e[e.P1A=2]="P1A",e[e.P1M_RA=3]="P1M_RA",e[e.P3M_RA=4]="P3M_RA",e[e.P1A_RA=5]="P1A_RA",e[e.TRIAL=6]="TRIAL"}(t.SubscriptionType||(t.SubscriptionType={}))},43:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),s=n(7),o=n(4),i=n(8),a=e=>{r.scribensUser.info=Object.assign({},e),c(r.scribensUser.info[16]),7 in r.scribensUser.info?u(r.scribensUser.info[7]):clearInterval(l)};chrome.runtime.onInstalled.addListener(e=>{switch(e.reason){case"install":break;case"update":(e=>new Promise((t,n)=>{chrome.storage.sync.get(e,e=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError.message),n(chrome.runtime.lastError.message)):t(e)})}))(["userInfo","settingsFormData"]).then(e=>(e=>("userInfo"in e&&(r.scribensUser.info=Object.assign({},e.userInfo),c(r.scribensUser.info[16]),7 in r.scribensUser.info?u(r.scribensUser.info[7]):clearInterval(l)),"settingsFormData"in e&&(r.scribensUser.options=Object.assign({},e.settingsFormData)),e))(e))}}),chrome.storage.onChanged.addListener((e,t)=>{"userInfo"in e&&a(e.userInfo.newValue),"settingsFormData"in e&&(r.scribensUser.options=Object.assign({},e.settingsFormData.newValue))}),chrome.runtime.onStartup.addListener(()=>{chrome.storage.sync.get(["userInfo"],e=>{e&&"userInfo"in e&&(new s.IdentificationServlet).estAbonne(e.userInfo[7],e.userInfo[8]).then(e=>e&&Object.keys(o.AuthErrors).includes(e[0])?(chrome.storage.sync.clear(),null):e).then(e=>{e&&(chrome.storage.sync.set({userInfo:e}),a(e))})})}),chrome.runtime.onConnect.addListener(e=>{console.assert("ScribensMessaging"===e.name),e.onMessage.addListener(t=>{switch(t.cmd){case"get:user":e.postMessage({cmd:"user",entries:r.scribensUser.info});break;case"get:options":e.postMessage({cmd:"options",entries:r.scribensUser.options});break;case"scribensCookies":if(t.value){const n=t.value.split("|"),i=!r.scribensUser.info||!Object.keys(r.scribensUser.info).length||t.value!==`${r.scribensUser.info[7]}|${r.scribensUser.info[8]}`;n.length&&i&&(new s.IdentificationServlet).estAbonne(n[0],n[1]).then(e=>e&&Object.keys(o.AuthErrors).includes(e[0])?null:e).then(t=>{t&&(chrome.storage.sync.set({userInfo:t,lastPage:"./menu.html"}),a(t),e.postMessage({cmd:"user",entries:r.scribensUser.info}))})}}})});const c=e=>{if(e&&/|/.test(e)){const t=i.stringToObject(e);chrome.storage.sync.get(["settingsFormData"],e=>{const n=e.settingsFormData||{};Object.keys(t).forEach(e=>{n[e]=t[e]}),chrome.storage.sync.set({settingsFormData:n})})}};let l=null;const u=e=>{l=setTimeout(()=>{(new s.IdentificationServlet).signalSessionActive(e).then(t=>{u(e)}).catch(e=>{console.log(e)})},1e4)}},7:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(i,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(2);t.IdentificationServlet=class extends s.HttpBase{constructor(){super(...arguments),this.servlet="Identification_Servlet"}estAbonne(e,t){return r(this,void 0,void 0,function*(){return this.request({FunctionName:"EstAbonne",Id:e,Password:t,plugin:s.HttpBase.plugin})})}identifiantExiste(e){return r(this,void 0,void 0,function*(){return this.request({FunctionName:"IdentifiantExiste",Email:e})})}newSubscription(e,t,n){return r(this,void 0,void 0,function*(){const r=chrome.runtime.getManifest();return this.request({FunctionName:"NewSubscription",Identifiant:e,MotDePasse:t,Prenom:n,Language:r.default_locale,plugin:s.HttpBase.plugin})})}sendMessageEmail(e,t,n,s="CONFIRMATION_INSCRIPTION"){return r(this,void 0,void 0,function*(){const r=chrome.runtime.getManifest();return this.request({FunctionName:"SendMessageEmail",IdMail:s,LangId:r.default_locale,EMail:e,MotDePasse:t,Prenom:n})})}sendSupportEmail(e,t,n){return r(this,void 0,void 0,function*(){return this.request({FunctionName:"SendSupportEmail",Id:e,Name:t,Message:n})})}majData(e,t,n){return r(this,void 0,void 0,function*(){return this.request({FunctionName:"MajData",TableName:"abonnement_client",DataName:t,DataValue:n,Id:e})})}signalSessionActive(e){return r(this,void 0,void 0,function*(){return this.request({FunctionName:"SignalSessionActive",Id:e,plugin:s.HttpBase.plugin})})}}},8:function(e,t,n){"use strict";function r(e){return e.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())}function s(e,t){if(e)switch(e.tagName){case"INPUT":"checkbox"===e.type?e.checked=Boolean(Number(t)):e.value=t;break;case"TEXTAREA":e.value=t;break;case"SELECT":[...e.options].some((n,r)=>{n.value===t&&(e.selectedIndex=r)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.stringToObject=function(e){return e&&/|/.test(e)?e.split("|").map(e=>{const t=e.split(":"),n={},r=String(t[0]).trim(),s=String(t[1]).trim();return n[r]=s,n}).reduce((e,t)=>Object.assign({},e,t),{}):{}},t.objectToString=function(e){return Object.keys(e).map(t=>`${t}: ${e[t]}`).join("|").replace(/\s+/g,"")},t.scribens_i18n=function(){[...document.querySelectorAll("[data-scribens-i18n]")].forEach(e=>{let t="";if(/^attr/.test(e.dataset.scribensI18n)){const[t,n]=e.dataset.scribensI18n.split("|")}else t=e.dataset.scribensI18n;if(/^html/.test(e.dataset.scribensI18n))e.innerHTML=chrome.i18n.getMessage(e.dataset.scribensI18n);else if(/^attr/.test(e.dataset.scribensI18n)){const[t,n]=e.dataset.scribensI18n.split("|"),[,r]=t.split(":");e.setAttribute(r,chrome.i18n.getMessage(n))}else e.innerText=chrome.i18n.getMessage(e.dataset.scribensI18n)})},t.enableRequirements=function(e){e.addEventListener("input",e=>{const t=e.target,n=t.parentNode.querySelector(".requirements");t.setCustomValidity(""),n&&[...n.querySelectorAll("div[data-validation]")].forEach(e=>{const n=new RegExp(e.getAttribute("data-validation")),r=e.querySelector("span"),s=e.getAttribute("data-string-raw"),o=e.getAttribute("data-reverse-result"),i=s?String.raw`${t.value}`:t.value;let a=n.test(i);o&&(a=!a),a?(r.innerText="√",e.className="text-green"):(r.innerText="x",e.className="text-red")})}),e.addEventListener("invalid",e=>{const t=e.target;t.parentNode.querySelector(".requirements")&&(t.dispatchEvent(new Event("input")),t.setCustomValidity(" "))}),e.addEventListener("focus",e=>{const t=e.target.parentNode.querySelector(".requirements");t&&(t.classList.add("show-requirements"),t.style.top=`${-Math.abs(t.getBoundingClientRect().height+3)}px`)},!0),e.addEventListener("blur",e=>{const t=e.target.parentNode.querySelector(".requirements");t&&t.classList.remove("show-requirements")},!0)},t.toCamelCase=r,t.replacePlaceholderElements=function(e,t,n=null,r=null){chrome.storage.sync.get([e],s=>{[...(r||document).querySelectorAll(t)].forEach(t=>{if(n)if(n instanceof Array)for(let r=0;r<n.length;r+=1){const o=n[r];if(s[e][o]){t.innerText=s[e][o];break}}else t.innerText=s[e][n];else t.innerText=s[e]})})},t.assignElementValue=s,t.statePageForm=function(e={},t=null){[...(t||document).querySelectorAll("form[data-name]")].forEach(t=>{const n={},o=r(`${t.getAttribute("data-name")}-data`);n[o]=Object.assign({},e),t.addEventListener("change",()=>{[...t.querySelectorAll("input, select, textarea")].filter(e=>e.name).forEach(e=>{n[o][e.name]="checkbox"===e.type?e.checked:e.value}),Object.keys(n[o]).length>0&&chrome.storage.sync.set(n)}),chrome.storage.sync.get(o,e=>{e&&e[o]&&Object.keys(e[o]).forEach(n=>{s(t.querySelector(`[name="${n}"]`),e[o][n])})})})},t.clearStatePageForm=function(e){const t=r(`${e instanceof Element?e.getAttribute("data-name"):e}-data`);chrome.storage.sync.remove(t)}}});